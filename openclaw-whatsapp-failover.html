<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenClaw: WhatsApp + Multi-Provider Failover â€” Nunca MÃ¡s Offline | Oscar Code</title>
  <meta name="description" content="CÃ³mo configurÃ© un agente de IA con 4 proveedores de respaldo, watchdog automÃ¡tico y reconexiÃ³n de WhatsApp para que nunca deje de responder.">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #00d4ff;
      --primary-dark: #00a8cc;
      --bg-dark: #0a0a0a;
      --bg-card: #111111;
      --text-primary: #ffffff;
      --text-secondary: rgba(255,255,255,0.7);
      --text-muted: rgba(255,255,255,0.5);
      --accent-orange: #ffab40;
      --accent-red: #ff6b6b;
      --accent-green: #69f0ae;
      --accent-blue: #4fc3f7;
      --accent-purple: #b388ff;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.8;
    }

    .container {
      max-width: 860px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .post-header {
      text-align: center;
      padding: 80px 20px 60px;
      background: linear-gradient(135deg, var(--bg-dark) 0%, #0a1a1f 50%, #0d2a2d 100%);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
    }

    .post-header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 30% 50%, rgba(0,212,255,0.06) 0%, transparent 50%),
                  radial-gradient(circle at 70% 50%, rgba(0,168,204,0.04) 0%, transparent 50%);
      animation: headerGlow 8s ease-in-out infinite;
    }

    @keyframes headerGlow {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--primary);
      text-decoration: none;
      margin-bottom: 30px;
      transition: all 0.3s;
      position: relative;
      z-index: 1;
    }

    .back-link:hover {
      color: var(--primary-dark);
      transform: translateX(-5px);
    }

    .post-title {
      font-size: 2.5em;
      margin-bottom: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent-green) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
      z-index: 1;
    }

    .post-subtitle {
      font-size: 1.15em;
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto 25px;
      position: relative;
      z-index: 1;
    }

    .post-meta {
      color: var(--text-muted);
      font-size: 0.9em;
      position: relative;
      z-index: 1;
    }

    .post-tag {
      display: inline-block;
      background: rgba(0,212,255,0.15);
      color: var(--primary);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      margin: 0 4px;
      border: 1px solid rgba(0,212,255,0.3);
    }

    .post-tag.devops {
      background: rgba(255,171,64,0.15);
      color: var(--accent-orange);
      border-color: rgba(255,171,64,0.3);
    }

    .post-content {
      padding: 60px 0;
    }

    .post-content h2 {
      font-size: 1.6em;
      margin: 50px 0 20px;
      color: var(--text-primary);
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(0,212,255,0.3);
    }

    .post-content h3 {
      font-size: 1.25em;
      margin: 35px 0 15px;
      color: var(--primary);
    }

    .post-content p {
      color: var(--text-secondary);
      margin-bottom: 20px;
      font-size: 1.05em;
    }

    .post-content ul, .post-content ol {
      color: var(--text-secondary);
      margin: 0 0 20px 25px;
    }

    .post-content li {
      margin-bottom: 8px;
    }

    .post-content a {
      color: var(--primary);
      text-decoration: none;
      border-bottom: 1px solid rgba(0,212,255,0.3);
      transition: all 0.3s;
    }

    .post-content a:hover {
      color: var(--accent-green);
      border-bottom-color: var(--accent-green);
    }

    .post-content code {
      background: rgba(0,212,255,0.12);
      color: var(--primary);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Fira Code', 'SF Mono', 'Cascadia Code', monospace;
      font-size: 0.9em;
    }

    .post-content pre {
      background: #0d1117;
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 20px 24px;
      margin: 20px 0 30px;
      overflow-x: auto;
      position: relative;
    }

    .post-content pre code {
      background: none;
      color: #e6edf3;
      padding: 0;
      font-size: 0.88em;
      line-height: 1.7;
    }

    .post-content pre .comment { color: #8b949e; }
    .post-content pre .command { color: var(--accent-green); }
    .post-content pre .flag { color: var(--accent-orange); }
    .post-content pre .string { color: #a5d6ff; }
    .post-content pre .output { color: var(--text-muted); font-style: italic; }

    .warning-box {
      background: rgba(255,107,107,0.08);
      border: 1px solid rgba(255,107,107,0.3);
      border-left: 4px solid var(--accent-red);
      border-radius: 0 12px 12px 0;
      padding: 25px 30px;
      margin: 30px 0;
    }

    .warning-box h4 {
      color: var(--accent-red);
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .warning-box p {
      color: var(--text-secondary);
      margin: 0;
    }

    .warning-box p:not(:last-child) { margin-bottom: 10px; }

    .warning-box code {
      background: rgba(255,107,107,0.15);
      color: var(--accent-red);
    }

    .info-box {
      background: rgba(79,195,247,0.08);
      border: 1px solid rgba(79,195,247,0.3);
      border-left: 4px solid var(--accent-blue);
      border-radius: 0 12px 12px 0;
      padding: 25px 30px;
      margin: 30px 0;
    }

    .info-box h4 {
      color: var(--accent-blue);
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .info-box p, .info-box li {
      color: var(--text-secondary);
    }

    .tip-box {
      background: rgba(105,240,174,0.08);
      border: 1px solid rgba(105,240,174,0.3);
      border-left: 4px solid var(--accent-green);
      border-radius: 0 12px 12px 0;
      padding: 25px 30px;
      margin: 30px 0;
    }

    .tip-box h4 {
      color: var(--accent-green);
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .tip-box p {
      color: var(--text-secondary);
      margin: 0;
    }

    .openclaw-box {
      background: rgba(255,171,64,0.08);
      border: 1px solid rgba(255,171,64,0.3);
      border-left: 4px solid var(--accent-orange);
      border-radius: 0 12px 12px 0;
      padding: 25px 30px;
      margin: 30px 0;
    }

    .openclaw-box h4 {
      color: var(--accent-orange);
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .openclaw-box p {
      color: var(--text-secondary);
      margin: 0;
    }

    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 30px 0;
      border-radius: 12px;
      overflow: hidden;
    }

    .comparison-table th {
      background: rgba(0,212,255,0.15);
      color: var(--primary);
      padding: 14px 20px;
      text-align: left;
      font-weight: 600;
      font-size: 0.95em;
    }

    .comparison-table td {
      padding: 14px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      color: var(--text-secondary);
      font-size: 0.95em;
    }

    .comparison-table tr:nth-child(even) td {
      background: rgba(255,255,255,0.02);
    }

    .comparison-table tr:hover td {
      background: rgba(0,212,255,0.05);
    }

    .summary-box {
      background: linear-gradient(135deg, rgba(0,212,255,0.08) 0%, rgba(105,240,174,0.08) 100%);
      border: 1px solid rgba(0,212,255,0.25);
      border-radius: 16px;
      padding: 35px;
      margin: 40px 0;
      text-align: center;
    }

    .summary-box h3 {
      color: var(--primary);
      margin-bottom: 15px;
      font-size: 1.5em;
    }

    .summary-box p {
      color: var(--text-secondary);
    }

    .ascii-diagram {
      background: #0d1117;
      border: 1px solid rgba(0,212,255,0.2);
      border-radius: 12px;
      padding: 25px 30px;
      margin: 30px 0;
      overflow-x: auto;
      font-family: 'Fira Code', 'SF Mono', monospace;
      font-size: 0.82em;
      line-height: 1.5;
      color: var(--accent-green);
      white-space: pre;
    }

    .post-footer {
      text-align: center;
      padding: 60px 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
      margin-top: 60px;
    }

    .post-footer p {
      color: var(--text-muted);
    }

    .post-footer a {
      color: var(--primary);
      text-decoration: none;
      transition: color 0.3s;
    }

    .post-footer a:hover {
      color: var(--accent-orange);
    }

    @media (max-width: 768px) {
      .post-title { font-size: 1.8em; }
      .post-subtitle { font-size: 1em; }
      .ascii-diagram { font-size: 0.7em; padding: 15px; }
      .post-content pre { padding: 15px; }
    }
  </style>
  <script src="public/i18n.js"></script>
  <link rel="stylesheet" href="visits-badge.css">
  <script src="visits-badge.js" defer></script>
</head>
<body>

  <header class="post-header">
    <div class="container">
      <a href="index.html" class="back-link">
        <i class="fas fa-arrow-left"></i> <span class="lang-es">Volver al inicio</span><span class="lang-en">Back to home</span>
      </a>
      <span class="lang-toggle" onclick="toggleLanguage()" style="position:absolute;top:30px;right:30px">ğŸŒ EN</span>
      <h1 class="post-title"><span class="lang-es">ğŸ¦ OpenClaw: WhatsApp + Multi-Provider Failover â€” Nunca MÃ¡s Offline</span><span class="lang-en">ğŸ¦ OpenClaw: WhatsApp + Multi-Provider Failover â€” Never Offline Again</span></h1>
    <div class="ov-views-wrap">
      <div class="ov-views-badge" data-ov-visits>
        <span class="ov-dot"></span>
        <span class="ov-label">Visitas</span>
        <span class="ov-count">â€”</span>
      </div>
    </div>

      <p class="post-subtitle"><span class="lang-es">CÃ³mo configurÃ© un agente de IA con 4 proveedores de respaldo, watchdog automÃ¡tico y reconexiÃ³n de WhatsApp para que nunca deje de responder.</span><span class="lang-en">How I configured an AI agent with 4 backup providers, an automatic watchdog, and WhatsApp reconnection so it never stops responding.</span></p>
      <div class="post-meta">
        <span class="post-tag">OpenClaw</span>
        <span class="post-tag">AI Agents</span>
        <span class="post-tag devops">DevOps</span>
        <br><br>
        <span><span class="lang-es">ğŸ“… 14-16 de Febrero, 2026 Â· â±ï¸ 15 min de lectura Â· Actualizado con post-mortem y anÃ¡lisis de falla triple</span><span class="lang-en">ğŸ“… February 14-16, 2026 Â· â±ï¸ 15 min read Â· Updated with post-mortem and triple failure analysis</span></span>
      </div>
    </div>
  </header>

  <main class="post-content">
    <div class="container">

      <p class="lang-es">Si usas <strong>OpenClaw</strong> para tener un agente de IA accesible por WhatsApp, sabes que la experiencia es increÃ­ble... hasta que deja de funcionar. Un reinicio del gateway, un token expirado, un DNS que falla â€” y de repente tu agente estÃ¡ muerto y nadie te avisa.</p>
      <p class="lang-en">If you use <strong>OpenClaw</strong> to have an AI agent accessible via WhatsApp, you know the experience is incredible... until it stops working. A gateway restart, an expired token, a failed DNS â€” and suddenly your agent is dead and nobody tells you.</p>

      <p class="lang-es">En este post te explico cÃ³mo configurÃ© mi setup para que sea <strong>prÃ¡cticamente indestructible</strong>: reconexiÃ³n automÃ¡tica de WhatsApp, un watchdog que revisa cada 15 minutos, y 4 proveedores de modelo en cadena de failover para que si uno se cae, el siguiente entre inmediatamente.</p>
      <p class="lang-en">In this post I explain how I configured my setup to be <strong>practically indestructible</strong>: automatic WhatsApp reconnection, a watchdog that checks every 15 minutes, and 4 model providers in a failover chain so if one goes down, the next one steps in immediately.</p>

      <div class="openclaw-box">
        <h4><span class="lang-es">ğŸ¦ Â¿QuÃ© es OpenClaw?</span><span class="lang-en">ğŸ¦ What is OpenClaw?</span></h4>
        <p class="lang-es">OpenClaw es una plataforma open-source para crear agentes de IA con acceso a canales de mensajerÃ­a (WhatsApp, Telegram, etc.), herramientas del sistema, y mÃºltiples proveedores de modelos. BÃ¡sicamente, un agente que vive en tu terminal y responde por WhatsApp.</p>
        <p class="lang-en">OpenClaw is an open-source platform for creating AI agents with access to messaging channels (WhatsApp, Telegram, etc.), system tools, and multiple model providers. Basically, an agent that lives in your terminal and responds via WhatsApp.</p>
      </div>

      <h2><span class="lang-es">1. El Problema</span><span class="lang-en">1. The Problem</span></h2>

      <p class="lang-es">Todo empezÃ³ cuando notÃ© que mi agente de OpenClaw habÃ­a dejado de responder por WhatsApp. Le mandaba mensajes y nada. Silencio absoluto.</p>
      <p class="lang-en">It all started when I noticed my OpenClaw agent had stopped responding via WhatsApp. I'd send messages and nothing. Complete silence.</p>

      <p class="lang-es">Al revisar los logs, encontrÃ© <strong>dos errores</strong> que se estaban encadenando:</p>
      <p class="lang-en">Looking at the logs, I found <strong>two errors</strong> that were chaining together:</p>

      <div class="warning-box">
        <h4><span class="lang-es">âš ï¸ Error 1: DNS temporal â€” ENOTFOUND</span><span class="lang-en">âš ï¸ Error 1: Temporary DNS â€” ENOTFOUND</span></h4>
        <p class="lang-es">El gateway de WhatsApp no podÃ­a resolver <code>web.whatsapp.com</code>. Esto pasa cuando hay una interrupciÃ³n de red momentÃ¡nea o el gateway se reinicia y la resoluciÃ³n DNS aÃºn no estÃ¡ lista.</p>
        <p class="lang-en">The WhatsApp gateway couldn't resolve <code>web.whatsapp.com</code>. This happens when there's a momentary network interruption or the gateway restarts and DNS resolution isn't ready yet.</p>
      </div>

      <pre><code><span class="output">[ERROR] WhatsApp channel disconnected</span>
<span class="output">  reason: getaddrinfo ENOTFOUND web.whatsapp.com</span>
<span class="output">  at: 2026-02-13T08:42:17.003Z</span>
<span class="output">  retry_count: 3</span>
<span class="output">  status: STOPPED</span></code></pre>

      <div class="warning-box">
        <h4><span class="lang-es">âš ï¸ Error 2: Token de Copilot expirado â€” HTTP 403</span><span class="lang-en">âš ï¸ Error 2: Copilot Token Expired â€” HTTP 403</span></h4>
        <p class="lang-es">El proveedor principal (GitHub Copilot) estaba devolviendo 403 Forbidden. El token de autenticaciÃ³n habÃ­a expirado y no se renovÃ³ automÃ¡ticamente. Resultado: aÃºn cuando el canal se reconectara, el agente no podÃ­a generar respuestas.</p>
        <p class="lang-en">The primary provider (GitHub Copilot) was returning 403 Forbidden. The authentication token had expired and didn't auto-renew. Result: even when the channel reconnected, the agent couldn't generate responses.</p>
      </div>

      <pre><code><span class="output">[ERROR] Model provider failed: github-copilot/claude-opus-4.6</span>
<span class="output">  status: 403 Forbidden</span>
<span class="output">  message: "Token expired or revoked"</span>
<span class="output">  fallback: none configured</span></code></pre>

      <p class="lang-es">O sea: <strong>doble falla</strong>. El canal de comunicaciÃ³n muerto Y el proveedor de modelo muerto. Sin fallback. Sin watchdog. Sin recuperaciÃ³n automÃ¡tica. Un desastre.</p>
      <p class="lang-en">In other words: <strong>double failure</strong>. The communication channel dead AND the model provider dead. No fallback. No watchdog. No automatic recovery. A disaster.</p>

      <h2><span class="lang-es">2. DiagnÃ³stico</span><span class="lang-en">2. Diagnosis</span></h2>

      <p class="lang-es">Antes de arreglar nada, hay que entender quÃ© pasÃ³. OpenClaw tiene comandos muy Ãºtiles para diagnosticar el estado de todo el sistema.</p>
      <p class="lang-en">Before fixing anything, you need to understand what happened. OpenClaw has very useful commands for diagnosing the state of the entire system.</p>

      <h3><span class="lang-es">Revisar el estado de los canales</span><span class="lang-en">Check Channel Status</span></h3>

      <pre><code><span class="command">openclaw channels status</span></code></pre>

      <p class="lang-es">Esto muestra el estado de cada canal conectado. En mi caso, WhatsApp aparecÃ­a como <code>STOPPED</code>:</p>
      <p class="lang-en">This shows the status of each connected channel. In my case, WhatsApp appeared as <code>STOPPED</code>:</p>

      <pre><code><span class="output">Channel      Status      Last Activity         Uptime</span>
<span class="output">â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€</span>
<span class="output">whatsapp     STOPPED     2026-02-13 08:42      0s</span>
<span class="output">terminal     CONNECTED   2026-02-14 10:15      1d 2h</span></code></pre>

      <h3><span class="lang-es">Revisar los logs del canal</span><span class="lang-en">Check Channel Logs</span></h3>

      <pre><code><span class="command">openclaw channels logs</span> <span class="flag">--channel whatsapp</span> <span class="flag">--tail 50</span></code></pre>

      <p class="lang-es">AquÃ­ es donde encontrÃ© los errores de DNS que mencionÃ© arriba. Los logs te dan el detalle completo de quÃ© pasÃ³ y cuÃ¡ndo.</p>
      <p class="lang-en">This is where I found the DNS errors I mentioned above. The logs give you the full detail of what happened and when.</p>

      <h3><span class="lang-es">Health check general</span><span class="lang-en">General Health Check</span></h3>

      <pre><code><span class="command">openclaw health</span></code></pre>

      <pre><code><span class="output">Component          Status    Details</span>
<span class="output">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€</span>
<span class="output">Gateway            âœ“ OK     pid: 48291, uptime: 1d 2h</span>
<span class="output">WhatsApp Channel   âœ— FAIL   STOPPED - ENOTFOUND web.whatsapp.com</span>
<span class="output">Model: openai      âœ“ OK     gpt-5.3-codex responding</span>
<span class="output">Model: copilot     âœ— FAIL   403 Forbidden - token expired</span>
<span class="output">Node.js            âœ“ OK     v22.14.0</span>
<span class="output">Cron               âœ“ OK     0 active jobs</span></code></pre>

      <div class="info-box">
        <h4>ğŸ’¡ Pro tip</h4>
        <p class="lang-es">Siempre corre <code>openclaw health</code> primero. Te da una vista panorÃ¡mica de todo lo que estÃ¡ bien y mal en un solo comando. Desde ahÃ­ sabes dÃ³nde enfocarte.</p>
        <p class="lang-en">Always run <code>openclaw health</code> first. It gives you a panoramic view of everything that's working and not in a single command. From there you know where to focus.</p>
      </div>

      <h2><span class="lang-es">3. SoluciÃ³n 1: Reconectar WhatsApp</span><span class="lang-en">3. Solution 1: Reconnect WhatsApp</span></h2>

      <p class="lang-es">Lo primero es lo primero: restaurar la conexiÃ³n del canal de WhatsApp.</p>
      <p class="lang-en">First things first: restore the WhatsApp channel connection.</p>

      <h3><span class="lang-es">Paso 1: Re-autenticar el canal</span><span class="lang-en">Step 1: Re-authenticate the Channel</span></h3>

      <pre><code><span class="command">openclaw channels login</span> <span class="flag">--channel whatsapp</span></code></pre>

      <p class="lang-es">Esto regenera la sesiÃ³n de WhatsApp. Te va a pedir escanear un cÃ³digo QR desde tu telÃ©fono (igual que WhatsApp Web). Una vez escaneado, la sesiÃ³n queda activa.</p>
      <p class="lang-en">This regenerates the WhatsApp session. It will ask you to scan a QR code from your phone (just like WhatsApp Web). Once scanned, the session becomes active.</p>

      <h3><span class="lang-es">Paso 2: Reiniciar el gateway</span><span class="lang-en">Step 2: Restart the Gateway</span></h3>

      <pre><code><span class="command">openclaw gateway restart</span></code></pre>

      <p class="lang-es">El gateway es el proceso que mantiene las conexiones activas. Al reiniciarlo, se reconectan todos los canales con las sesiones actualizadas.</p>
      <p class="lang-en">The gateway is the process that keeps connections active. When restarting it, all channels reconnect with updated sessions.</p>

      <pre><code><span class="output">Gateway restarting...</span>
<span class="output">  WhatsApp: reconnecting... âœ“ CONNECTED</span>
<span class="output">  Terminal: reconnecting... âœ“ CONNECTED</span>
<span class="output">Gateway ready (pid: 51023)</span></code></pre>

      <h3><span class="lang-es">Paso 3: Verificar</span><span class="lang-en">Step 3: Verify</span></h3>

      <pre><code><span class="command">openclaw channels status</span>

<span class="output">Channel      Status       Last Activity         Uptime</span>
<span class="output">â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€</span>
<span class="output">whatsapp     CONNECTED    2026-02-14 10:30      2m</span>
<span class="output">terminal     CONNECTED    2026-02-14 10:30      1d 2h</span></code></pre>

      <div class="tip-box">
        <h4><span class="lang-es">âœ” Canal restaurado</span><span class="lang-en">âœ” Channel Restored</span></h4>
        <p class="lang-es">WhatsApp vuelve a estar <code>CONNECTED</code>. Pero esto fue un fix manual. Si se vuelve a caer a las 3am, Â¿quiÃ©n lo reconecta? Nadie. Por eso necesitamos el watchdog.</p>
        <p class="lang-en">WhatsApp is <code>CONNECTED</code> again. But this was a manual fix. If it goes down again at 3am, who reconnects it? Nobody. That's why we need the watchdog.</p>
      </div>

      <h2><span class="lang-es">4. SoluciÃ³n 2: Watchdog AutomÃ¡tico (Cron)</span><span class="lang-en">4. Solution 2: Automatic Watchdog (Cron)</span></h2>

      <p class="lang-es">La idea es simple: un cron job que corre cada 15 minutos, revisa si WhatsApp estÃ¡ conectado, y si no lo estÃ¡, lo reconecta automÃ¡ticamente. Lo mejor es que OpenClaw tiene esto integrado â€” no necesitas crontab del sistema ni scripts externos.</p>
      <p class="lang-en">The idea is simple: a cron job that runs every 15 minutes, checks if WhatsApp is connected, and if it isn't, reconnects it automatically. The best part is that OpenClaw has this built in â€” you don't need system crontab or external scripts.</p>

      <h3><span class="lang-es">Crear el watchdog</span><span class="lang-en">Create the Watchdog</span></h3>

      <pre><code><span class="command">openclaw cron add</span> \
  <span class="flag">--name</span> <span class="string">"whatsapp-watchdog"</span> \
  <span class="flag">--every</span> <span class="string">15m</span> \
  <span class="flag">--message</span> <span class="string">"Revisa el estado del canal de WhatsApp. Si estÃ¡ desconectado o stopped, ejecuta 'openclaw gateway restart' para reconectarlo."</span> \
  <span class="flag">--channel</span> <span class="string">whatsapp</span> \
  <span class="flag">--to</span> <span class="string">"+52XXXXXXXXXX"</span> \
  <span class="flag">--best-effort-deliver</span></code></pre>

      <p class="lang-es">Â¿QuÃ© hace esto exactamente?</p>
      <p class="lang-en">What does this do exactly?</p>

      <ul>
        <li class="lang-es"><code>--every 15m</code> â€” Se ejecuta cada 15 minutos.</li>
        <li class="lang-en"><code>--every 15m</code> â€” Runs every 15 minutes.</li>
        <li class="lang-es"><code>--message</code> â€” Le dice al agente quÃ© hacer. El agente usa sus tools para verificar el estado y tomar acciÃ³n.</li>
        <li class="lang-en"><code>--message</code> â€” Tells the agent what to do. The agent uses its tools to check status and take action.</li>
        <li class="lang-es"><code>--channel whatsapp</code> â€” El contexto del canal a monitorear.</li>
        <li class="lang-en"><code>--channel whatsapp</code> â€” The channel context to monitor.</li>
        <li class="lang-es"><code>--to "+52XXXXXXXXXX"</code> â€” NÃºmero de destino para las notificaciones.</li>
        <li class="lang-en"><code>--to "+52XXXXXXXXXX"</code> â€” Destination number for notifications.</li>
        <li class="lang-es"><code>--best-effort-deliver</code> â€” Si no puede entregar el mensaje (porque WhatsApp estÃ¡ caÃ­do), no falla el cron â€” simplemente lo intenta y sigue adelante.</li>
        <li class="lang-en"><code>--best-effort-deliver</code> â€” If it can't deliver the message (because WhatsApp is down), the cron doesn't fail â€” it simply tries and moves on.</li>
      </ul>

      <div class="info-box">
        <h4><span class="lang-es">ğŸ”„ Â¿CÃ³mo funciona internamente?</span><span class="lang-en">ğŸ”„ How Does It Work Internally?</span></h4>
        <p class="lang-es">El cron de OpenClaw no es un crontab de Unix. Es un scheduler interno que vive en el gateway. Cada 15 minutos, invoca al agente con el mensaje que le diste, el agente analiza el estado usando sus herramientas (<code>channels_status</code>, <code>gateway_restart</code>, etc.) y toma las acciones necesarias. Es como tener un DevOps bot viviendo en tu mÃ¡quina.</p>
        <p class="lang-en">The OpenClaw cron is not a Unix crontab. It's an internal scheduler that lives in the gateway. Every 15 minutes, it invokes the agent with the message you gave it, the agent analyzes status using its tools (<code>channels_status</code>, <code>gateway_restart</code>, etc.) and takes the necessary actions. It's like having a DevOps bot living on your machine.</p>
      </div>

      <h3><span class="lang-es">Verificar que el cron estÃ¡ activo</span><span class="lang-en">Verify That the Cron Is Active</span></h3>

      <pre><code><span class="command">openclaw cron list</span>

<span class="output">Name                  Interval    Next Run              Channel     Status</span>
<span class="output">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€</span>
<span class="output">whatsapp-watchdog     15m         2026-02-14 10:45      whatsapp    ACTIVE</span></code></pre>

      <div class="tip-box">
        <h4><span class="lang-es">âœ” Watchdog activo</span><span class="lang-en">âœ” Watchdog Active</span></h4>
        <p class="lang-es">Ahora si WhatsApp se desconecta a las 3am, el watchdog lo detecta en mÃ¡ximo 15 minutos y lo reconecta solo. Puedes dormir tranquilo.</p>
        <p class="lang-en">Now if WhatsApp disconnects at 3am, the watchdog detects it in at most 15 minutes and reconnects it on its own. You can sleep easy.</p>
      </div>

      <h2><span class="lang-es">5. SoluciÃ³n 3: Multi-Provider Failover</span><span class="lang-en">5. Solution 3: Multi-Provider Failover</span></h2>

      <p class="lang-es">El canal ya se reconecta solo. Pero Â¿quÃ© pasa si el <em>modelo</em> falla? Si tu Ãºnico proveedor es GitHub Copilot y el token expira, el agente recibe mensajes pero no puede responder. Necesitamos un plan B. Y un plan C. Y un plan D.</p>
      <p class="lang-en">The channel already reconnects on its own. But what if the <em>model</em> fails? If your only provider is GitHub Copilot and the token expires, the agent receives messages but can't respond. We need a plan B. And a plan C. And a plan D.</p>

      <h3><span class="lang-es">La cadena de failover</span><span class="lang-en">The Failover Chain</span></h3>

      <table class="comparison-table">
        <thead>
          <tr>
            <th><span class="lang-es">Prioridad</span><span class="lang-en">Priority</span></th>
            <th><span class="lang-es">Proveedor</span><span class="lang-en">Provider</span></th>
            <th><span class="lang-es">Modelo</span><span class="lang-en">Model</span></th>
            <th><span class="lang-es">Notas</span><span class="lang-en">Notes</span></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Primary</strong></td>
            <td>OpenAI Codex</td>
            <td><code>openai-codex/gpt-5.3-codex</code></td>
            <td><span class="lang-es">El mÃ¡s rÃ¡pido, ideal para respuestas del dÃ­a a dÃ­a</span><span class="lang-en">The fastest, ideal for day-to-day responses</span></td>
          </tr>
          <tr>
            <td><strong>Fallback #1</strong></td>
            <td>GitHub Copilot</td>
            <td><code>github-copilot/claude-opus-4.6</code></td>
            <td><span class="lang-es">Claude Opus vÃ­a Copilot proxy, muy capaz</span><span class="lang-en">Claude Opus via Copilot proxy, very capable</span></td>
          </tr>
          <tr>
            <td><strong>Fallback #2</strong></td>
            <td>Copilot Proxy</td>
            <td><code>copilot-proxy/claude-sonnet-4.5</code></td>
            <td><span class="lang-es">Sonnet vÃ­a Copilot, mÃ¡s ligero pero confiable</span><span class="lang-en">Sonnet via Copilot, lighter but reliable</span></td>
          </tr>
          <tr>
            <td><strong>Fallback #3</strong></td>
            <td>Anthropic (Claude Code)</td>
            <td><code>anthropic/claude-sonnet-4-5-20250929</code></td>
            <td><span class="lang-es">Directo desde Claude Code subscription</span><span class="lang-en">Directly from Claude Code subscription</span></td>
          </tr>
        </tbody>
      </table>

      <p class="lang-es">La lÃ³gica es: si el proveedor primario falla (timeout, 403, 500, rate limit), OpenClaw automÃ¡ticamente intenta el siguiente en la lista. Si ese tambiÃ©n falla, pasa al siguiente. AsÃ­ sucesivamente hasta que uno responda.</p>
      <p class="lang-en">The logic is: if the primary provider fails (timeout, 403, 500, rate limit), OpenClaw automatically tries the next one on the list. If that one also fails, it moves to the next. And so on until one responds.</p>

      <h3><span class="lang-es">Configurar los fallbacks</span><span class="lang-en">Configure the Fallbacks</span></h3>

      <pre><code><span class="command">openclaw config set</span> <span class="flag">agents.defaults.model.fallbacks</span> \
  <span class="string">'["github-copilot/claude-opus-4.6","copilot-proxy/claude-sonnet-4.5","anthropic/claude-sonnet-4-5-20250929"]'</span> \
  <span class="flag">--json</span></code></pre>

      <pre><code><span class="output">âœ“ Config updated: agents.defaults.model.fallbacks</span>
<span class="output">   [0] github-copilot/claude-opus-4.6</span>
<span class="output">   [1] copilot-proxy/claude-sonnet-4.5</span>
<span class="output">   [2] anthropic/claude-sonnet-4-5-20250929</span></code></pre>

      <div class="info-box">
        <h4><span class="lang-es">ğŸ’¡ Â¿Por quÃ© este orden?</span><span class="lang-en">ğŸ’¡ Why This Order?</span></h4>
        <p class="lang-es">El modelo primario (<code>openai-codex/gpt-5.3-codex</code>) ya estÃ¡ configurado como default. Los fallbacks se prueban en orden. Puse Claude Opus primero porque es el mÃ¡s capaz. Sonnet como segundo porque es rÃ¡pido y barato. Y el de Anthropic directo como Ãºltimo recurso porque usa los crÃ©ditos de mi suscripciÃ³n de Claude Code.</p>
        <p class="lang-en">The primary model (<code>openai-codex/gpt-5.3-codex</code>) is already configured as default. Fallbacks are tried in order. I put Claude Opus first because it's the most capable. Sonnet as second because it's fast and cheap. And Anthropic direct as last resort because it uses my Claude Code subscription credits.</p>
      </div>

      <h2><span class="lang-es">6. Configurar GitHub Copilot como Provider</span><span class="lang-en">6. Configure GitHub Copilot as Provider</span></h2>

      <p class="lang-es">Para que OpenClaw pueda usar modelos vÃ­a GitHub Copilot, necesitas autenticarte con el device flow de GitHub:</p>
      <p class="lang-en">For OpenClaw to use models via GitHub Copilot, you need to authenticate with the GitHub device flow:</p>

      <pre><code><span class="command">openclaw models auth login-github-copilot</span></code></pre>

      <pre><code><span class="output">ğŸ” GitHub Copilot Authentication</span>
<span class="output">   Open this URL in your browser:</span>
<span class="output">   â†’ https://github.com/login/device</span>
<span class="output"></span>
<span class="output">   Enter this code: ABCD-1234</span>
<span class="output"></span>
<span class="output">   Waiting for authorization...</span></code></pre>

      <p class="lang-es">El proceso es:</p>
      <p class="lang-en">The process is:</p>
      <ol>
        <li class="lang-es">Abre <a href="https://github.com/login/device" target="_blank">https://github.com/login/device</a> en tu navegador.</li>
        <li class="lang-en">Open <a href="https://github.com/login/device" target="_blank">https://github.com/login/device</a> in your browser.</li>
        <li class="lang-es">Ingresa el cÃ³digo que te muestra la terminal.</li>
        <li class="lang-en">Enter the code shown in the terminal.</li>
        <li class="lang-es">Autoriza el acceso.</li>
        <li class="lang-en">Authorize access.</li>
        <li class="lang-es">La terminal detecta la autorizaciÃ³n automÃ¡ticamente.</li>
        <li class="lang-en">The terminal automatically detects the authorization.</li>
      </ol>

      <pre><code><span class="output">   âœ“ Authenticated as @oscarcode9</span>
<span class="output">   Token stored securely.</span>
<span class="output">   Available models: claude-opus-4.6, claude-sonnet-4.5, gpt-4o, o1...</span></code></pre>

      <div class="warning-box">
        <h4>âš ï¸ Token expiration</h4>
        <p class="lang-es">Los tokens de Copilot expiran periÃ³dicamente. Si ves errores 403, re-ejecuta <code>openclaw models auth login-github-copilot</code> para renovar. Con el failover configurado, incluso si el token expira, los otros proveedores toman el relevo mientras lo renuevas.</p>
        <p class="lang-en">Copilot tokens expire periodically. If you see 403 errors, re-run <code>openclaw models auth login-github-copilot</code> to renew. With failover configured, even if the token expires, the other providers take over while you renew it.</p>
      </div>

      <h2><span class="lang-es">7. Configurar Claude Code como Provider</span><span class="lang-en">7. Configure Claude Code as Provider</span></h2>

      <p class="lang-es">Esta es la parte mÃ¡s elegante del setup. OpenClaw puede leer las credenciales de Claude Code directamente desde el <strong>macOS Keychain</strong>. Si ya tienes Claude Code instalado y autenticado, no necesitas configurar tokens ni API keys manualmente.</p>
      <p class="lang-en">This is the most elegant part of the setup. OpenClaw can read Claude Code credentials directly from the <strong>macOS Keychain</strong>. If you already have Claude Code installed and authenticated, you don't need to configure tokens or API keys manually.</p>

      <div class="tip-box">
        <h4><span class="lang-es">ğŸ”‘ Credenciales automÃ¡ticas</span><span class="lang-en">ğŸ”‘ Automatic Credentials</span></h4>
        <p class="lang-es">OpenClaw busca las credenciales en el Keychain de macOS bajo el nombre <code>Claude Code-credentials</code>. Si Claude Code estÃ¡ autenticado en tu mÃ¡quina, OpenClaw las encuentra y las usa directamente. Zero config.</p>
        <p class="lang-en">OpenClaw looks for credentials in the macOS Keychain under the name <code>Claude Code-credentials</code>. If Claude Code is authenticated on your machine, OpenClaw finds and uses them directly. Zero config.</p>
      </div>

      <p class="lang-es">Lo Ãºnico que necesitas hacer es decirle a OpenClaw que ese modelo existe como opciÃ³n:</p>
      <p class="lang-en">The only thing you need to do is tell OpenClaw that model exists as an option:</p>

      <pre><code><span class="command">openclaw config set</span> <span class="flag">agents.defaults.models.anthropic/claude-sonnet-4-5-20250929</span> <span class="string">'{}'</span> <span class="flag">--json</span></code></pre>

      <pre><code><span class="output">âœ“ Config updated: agents.defaults.models.anthropic/claude-sonnet-4-5-20250929</span>
<span class="output">   Auth: macOS Keychain (Claude Code-credentials) âœ“</span>
<span class="output">   Model: claude-sonnet-4-5-20250929</span>
<span class="output">   Status: ready</span></code></pre>

      <p class="lang-es">Eso es todo. El <code>{}</code> vacÃ­o significa "usa las credenciales que ya tienes". OpenClaw detecta el Keychain, extrae el token, y lo usa cuando necesita hacer requests a la API de Anthropic.</p>
      <p class="lang-en">That's it. The empty <code>{}</code> means "use the credentials you already have". OpenClaw detects the Keychain, extracts the token, and uses it when it needs to make requests to the Anthropic API.</p>

      <div class="info-box">
        <h4><span class="lang-es">ğŸ’¡ Â¿Por quÃ© es el Ãºltimo fallback?</span><span class="lang-en">ğŸ’¡ Why Is It the Last Fallback?</span></h4>
        <p class="lang-es">Porque los requests a la API directa de Anthropic se descuentan de tu suscripciÃ³n de Claude Code. Los otros proveedores (Copilot) usan sus propios crÃ©ditos. Entonces reservo Anthropic directo como Ãºltimo recurso para no gastar crÃ©ditos innecesariamente.</p>
        <p class="lang-en">Because requests to the direct Anthropic API are deducted from your Claude Code subscription. The other providers (Copilot) use their own credits. So I reserve Anthropic direct as a last resort to avoid spending credits unnecessarily.</p>
      </div>

      <h2><span class="lang-es">8. Instalar Node.js del Sistema</span><span class="lang-en">8. Install System Node.js</span></h2>

      <p class="lang-es">El gateway de OpenClaw corre sobre Node.js. Si estÃ¡s usando la versiÃ³n que viene con algÃºn version manager (nvm, fnm, etc.), puede haber problemas de estabilidad cuando el gateway se ejecuta como proceso de fondo â€” especialmente despuÃ©s de reinicios del sistema.</p>
      <p class="lang-en">The OpenClaw gateway runs on Node.js. If you're using the version that comes with a version manager (nvm, fnm, etc.), there can be stability issues when the gateway runs as a background process â€” especially after system restarts.</p>

      <p class="lang-es">La soluciÃ³n es instalar Node.js directamente con Homebrew para que estÃ© disponible a nivel de sistema:</p>
      <p class="lang-en">The solution is to install Node.js directly with Homebrew so it's available system-wide:</p>

      <pre><code><span class="command">brew install node</span></code></pre>

      <p class="lang-es">DespuÃ©s, ejecuta el doctor de OpenClaw para que detecte y use la instalaciÃ³n del sistema:</p>
      <p class="lang-en">Then, run the OpenClaw doctor so it detects and uses the system installation:</p>

      <pre><code><span class="command">openclaw doctor --fix</span></code></pre>

      <pre><code><span class="output">ğŸ” Running diagnostics...</span>
<span class="output"></span>
<span class="output">  Node.js        âœ“  v22.14.0 (/opt/homebrew/bin/node)</span>
<span class="output">  npm            âœ“  v10.9.2</span>
<span class="output">  Gateway        âœ“  running (pid: 51023)</span>
<span class="output">  WhatsApp       âœ“  CONNECTED</span>
<span class="output">  Models         âœ“  4 configured (1 primary + 3 fallbacks)</span>
<span class="output">  Cron           âœ“  1 active job</span>
<span class="output">  Keychain       âœ“  Claude Code-credentials found</span>
<span class="output"></span>
<span class="output">âœ“ All checks passed. No fixes needed.</span></code></pre>

      <div class="tip-box">
        <h4><span class="lang-es">âœ” Sistema estable</span><span class="lang-en">âœ” Stable System</span></h4>
        <p class="lang-es">Con Node.js instalado vÃ­a Homebrew, el gateway tiene una instalaciÃ³n de Node confiable que no depende de la sesiÃ³n de shell ni de variables de entorno de nvm. Esto es especialmente importante para que el watchdog funcione correctamente en background.</p>
        <p class="lang-en">With Node.js installed via Homebrew, the gateway has a reliable Node installation that doesn't depend on the shell session or nvm environment variables. This is especially important for the watchdog to work correctly in the background.</p>
      </div>

      <h2><span class="lang-es">9. Verificar Todo</span><span class="lang-en">9. Verify Everything</span></h2>

      <p class="lang-es">Ya tenemos todo configurado. Ahora hay que probar que cada proveedor funciona y que el canal de WhatsApp entrega los mensajes correctamente.</p>
      <p class="lang-en">Everything is configured. Now let's verify that each provider works and that the WhatsApp channel delivers messages correctly.</p>

      <h3><span class="lang-es">Probar el envÃ­o por WhatsApp</span><span class="lang-en">Test WhatsApp Delivery</span></h3>

      <pre><code><span class="command">openclaw agent</span> \
  <span class="flag">-m</span> <span class="string">"Responde con: Soy [provider] y estoy funcionando"</span> \
  <span class="flag">--to</span> <span class="string">"+52XXXXXXXXXX"</span> \
  <span class="flag">--channel</span> <span class="string">whatsapp</span> \
  <span class="flag">--deliver</span></code></pre>

      <p class="lang-es">Si todo estÃ¡ bien, deberÃ­as recibir un mensaje en WhatsApp con el nombre del proveedor que respondiÃ³.</p>
      <p class="lang-en">If everything is working, you should receive a message on WhatsApp with the name of the provider that responded.</p>

      <h3><span class="lang-es">Verificar la configuraciÃ³n de modelos</span><span class="lang-en">Verify Model Configuration</span></h3>

      <pre><code><span class="command">openclaw models list</span></code></pre>

      <pre><code><span class="output">Role          Provider                Model                              Status</span>
<span class="output">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€</span>
<span class="output">default       openai-codex            gpt-5.3-codex                      âœ“ OK</span>
<span class="output">fallback#1    github-copilot          claude-opus-4.6                    âœ“ OK</span>
<span class="output">fallback#2    copilot-proxy           claude-sonnet-4.5                  âœ“ OK</span>
<span class="output">fallback#3    anthropic               claude-sonnet-4-5-20250929         âœ“ OK</span></code></pre>

      <p class="lang-es">Los 4 proveedores deben mostrar <code>OK</code>. Si alguno muestra error, revisa la autenticaciÃ³n de ese proveedor especÃ­fico.</p>
      <p class="lang-en">All 4 providers should show <code>OK</code>. If any shows an error, check the authentication for that specific provider.</p>

      <h3><span class="lang-es">Probar el failover manualmente</span><span class="lang-en">Test Failover Manually</span></h3>

      <pre><code><span class="comment"># Deshabilitar temporalmente el proveedor primario</span>
<span class="command">openclaw config set</span> <span class="flag">agents.defaults.model.enabled</span> <span class="string">false</span>

<span class="comment"># Enviar un mensaje â€” deberÃ­a usar fallback#1</span>
<span class="command">openclaw agent</span> <span class="flag">-m</span> <span class="string">"Â¿QuÃ© modelo me estÃ¡ respondiendo?"</span> <span class="flag">--to</span> <span class="string">"+52XXXXXXXXXX"</span> <span class="flag">--channel</span> <span class="string">whatsapp</span> <span class="flag">--deliver</span>

<span class="comment"># Re-habilitar el proveedor primario</span>
<span class="command">openclaw config set</span> <span class="flag">agents.defaults.model.enabled</span> <span class="string">true</span></code></pre>

      <div class="tip-box">
        <h4><span class="lang-es">âœ” Failover verificado</span><span class="lang-en">âœ” Failover Verified</span></h4>
        <p class="lang-es">Si recibes respuesta cuando el primario estÃ¡ deshabilitado, el failover estÃ¡ funcionando correctamente. El agente cambiÃ³ automÃ¡ticamente al siguiente proveedor disponible.</p>
        <p class="lang-en">If you receive a response when the primary is disabled, failover is working correctly. The agent automatically switched to the next available provider.</p>
      </div>

      <h2><span class="lang-es">10. Resultado Final</span><span class="lang-en">10. Final Result</span></h2>

      <p class="lang-es">AquÃ­ estÃ¡ el diagrama completo del flujo de failover:</p>
      <p class="lang-en">Here's the complete failover flow diagram:</p>

      <div class="ascii-diagram">
  ğŸ“± WhatsApp Message
       â”‚
       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   OpenClaw Gateway     â”‚â—„â”€â”€â”€â”€ Watchdog (cada 15min / every 15min)
  â”‚   (Node.js process)    â”‚      reconecta si STOPPED / reconnects if STOPPED
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Model Router         â”‚
  â”‚   (failover chain)     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                          â”‚
     â†“                                          â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
  â”‚ PRIMARY          â”‚â”€â”€â”€â”€ OK â”€â”€â”€â”€ Responde â”€â”€â–º ğŸ“±â”‚
  â”‚ openai-codex/    â”‚                          â”‚
  â”‚ gpt-5.3-codex    â”‚                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
         â”‚ FAIL                                 â”‚
         â†“                                      â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
  â”‚ FALLBACK #1      â”‚â”€â”€â”€â”€ OK â”€â”€â”€â”€ Responde â”€â”€â–º ğŸ“±â”‚
  â”‚ github-copilot/  â”‚                          â”‚
  â”‚ claude-opus-4.6  â”‚                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
         â”‚ FAIL                                 â”‚
         â†“                                      â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
  â”‚ FALLBACK #2      â”‚â”€â”€â”€â”€ OK â”€â”€â”€â”€ Responde â”€â”€â–º ğŸ“±â”‚
  â”‚ copilot-proxy/   â”‚                          â”‚
  â”‚ claude-sonnet-4.5â”‚                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
         â”‚ FAIL                                 â”‚
         â†“                                      â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
  â”‚ FALLBACK #3      â”‚â”€â”€â”€â”€ OK â”€â”€â”€â”€ Responde â”€â”€â–º ğŸ“±â”‚
  â”‚ anthropic/       â”‚                          â”‚
  â”‚ claude-sonnet-4-5â”‚                          â”‚
  â”‚ (Claude Code)    â”‚                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                                                â”‚
  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ </div>

      <h3><span class="lang-es">Resumen de lo que configuramos</span><span class="lang-en">Summary of What We Configured</span></h3>

      <div class="summary-box">
        <h3><span class="lang-es">ğŸ¦ Setup Final</span><span class="lang-en">ğŸ¦ Final Setup</span></h3>
        <p><span class="lang-es">Un agente de OpenClaw que es prÃ¡cticamente indestructible:</span><span class="lang-en">An OpenClaw agent that is practically indestructible:</span></p>
      </div>

      <table class="comparison-table">
        <thead>
          <tr>
            <th><span class="lang-es">Componente</span><span class="lang-en">Component</span></th>
            <th><span class="lang-es">QuÃ© hace</span><span class="lang-en">What It Does</span></th>
            <th><span class="lang-es">Estado</span><span class="lang-en">Status</span></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>WhatsApp Channel</strong></td>
            <td><span class="lang-es">Canal de comunicaciÃ³n principal</span><span class="lang-en">Main communication channel</span></td>
            <td>âœ“ CONNECTED</td>
          </tr>
          <tr>
            <td><strong>Watchdog Cron</strong></td>
            <td><span class="lang-es">Revisa WhatsApp cada 15 min, reconecta si se cae</span><span class="lang-en">Checks WhatsApp every 15 min, reconnects if it goes down</span></td>
            <td>âœ“ ACTIVE</td>
          </tr>
          <tr>
            <td><strong>4 <span class="lang-es">Proveedores</span><span class="lang-en">Providers</span></strong></td>
            <td><span class="lang-es">Cadena de failover automÃ¡tica de modelos</span><span class="lang-en">Automatic model failover chain</span></td>
            <td>âœ“ 4/4 OK</td>
          </tr>
          <tr>
            <td><strong>Node.js (Homebrew)</strong></td>
            <td><span class="lang-es">Runtime estable a nivel de sistema</span><span class="lang-en">Stable system-level runtime</span></td>
            <td>âœ“ v22.14.0</td>
          </tr>
          <tr>
            <td><strong>Claude Code Keychain</strong></td>
            <td><span class="lang-es">Credenciales Anthropic sin configuraciÃ³n manual</span><span class="lang-en">Anthropic credentials without manual configuration</span></td>
            <td>âœ“ Auto-detected</td>
          </tr>
        </tbody>
      </table>

      <p class="lang-es">Con esta configuraciÃ³n, el agente puede sobrevivir:</p>
      <p class="lang-en">With this configuration, the agent can survive:</p>
      <ul>
        <li class="lang-es"><strong>CaÃ­da de WhatsApp</strong> â€” el watchdog lo reconecta en 15 minutos mÃ¡ximo.</li>
        <li class="lang-en"><strong>WhatsApp outage</strong> â€” the watchdog reconnects it in at most 15 minutes.</li>
        <li class="lang-es"><strong>Token de Copilot expirado</strong> â€” usa el siguiente proveedor en la cadena.</li>
        <li class="lang-en"><strong>Expired Copilot token</strong> â€” uses the next provider in the chain.</li>
        <li class="lang-es"><strong>Rate limit de OpenAI</strong> â€” pasa a Copilot automÃ¡ticamente.</li>
        <li class="lang-en"><strong>OpenAI rate limit</strong> â€” automatically falls back to Copilot.</li>
        <li class="lang-es"><strong>CaÃ­da total de Copilot</strong> â€” usa Anthropic directo vÃ­a Claude Code credentials.</li>
        <li class="lang-en"><strong>Complete Copilot outage</strong> â€” uses Anthropic directly via Claude Code credentials.</li>
        <li class="lang-es"><strong>Reinicio del sistema</strong> â€” Node.js del sistema + gateway que se restaura.</li>
        <li class="lang-en"><strong>System restart</strong> â€” system Node.js + gateway that restores itself.</li>
      </ul>

      <p><s><span class="lang-es">El Ãºnico escenario que <em>no</em> estÃ¡ cubierto es si los 4 proveedores fallan al mismo tiempo.</span><span class="lang-en">The only scenario <em>not</em> covered is if all 4 providers fail at the same time.</span></s> <span class="lang-es">Spoiler: sÃ­ pasÃ³. Sigue leyendo.</span><span class="lang-en">Spoiler: it happened. Keep reading.</span></p>

      <h2><span class="lang-es">11. Post-Mortem: Cuando el Failover No Failoverea</span><span class="lang-en">11. Post-Mortem: When Failover Doesn't Fail Over</span></h2>

      <p class="lang-es">Plot twist: despuÃ©s de configurar todo lo anterior, el bot se volviÃ³ a caer. Le mandaba mensajes por WhatsApp y respondÃ­a <code>"Connection error."</code> como texto literal. La cadena de failover estaba configurada... pero no funcionaba.</p>
      <p class="lang-en">Plot twist: after configuring everything above, the bot went down again. I'd send messages via WhatsApp and it would respond with <code>"Connection error."</code> as literal text. The failover chain was configured... but wasn't working.</p>

      <div class="warning-box">
        <h4><span class="lang-es">âš ï¸ El error real</span><span class="lang-en">âš ï¸ The Real Error</span></h4>
        <p class="lang-es">Al revisar los logs del agente, encontrÃ© esto: <code>FailoverError: No API key found for provider "anthropic". Auth store: ~/.openclaw/agents/main/agent/auth-profiles.json</code>. Anthropic fallaba porque sus credenciales <strong>no estaban en el auth-profiles del agente</strong>.</p>
        <p class="lang-en">Looking at the agent logs, I found this: <code>FailoverError: No API key found for provider "anthropic". Auth store: ~/.openclaw/agents/main/agent/auth-profiles.json</code>. Anthropic was failing because its credentials <strong>were not in the agent's auth-profiles</strong>.</p>
      </div>

      <h3><span class="lang-es">Â¿QuÃ© pasÃ³?</span><span class="lang-en">What Happened?</span></h3>

      <p class="lang-es">El problema fue que configuramos el modelo de Anthropic en <code>openclaw.json</code> (la config global), pero <strong>nunca copiamos las credenciales al archivo de autenticaciÃ³n del agente</strong>. OpenClaw separa la configuraciÃ³n de modelos de la autenticaciÃ³n:</p>
      <p class="lang-en">The problem was that we configured the Anthropic model in <code>openclaw.json</code> (the global config), but <strong>never copied the credentials to the agent's authentication file</strong>. OpenClaw separates model configuration from authentication:</p>

      <ul>
        <li class="lang-es"><code>openclaw.json</code> â€” Define quÃ© modelos existen y cuÃ¡l es el primary/fallback.</li>
        <li class="lang-en"><code>openclaw.json</code> â€” Defines what models exist and which is the primary/fallback.</li>
        <li class="lang-es"><code>agents/main/agent/auth-profiles.json</code> â€” Contiene los tokens/credenciales reales que el agente usa para autenticarse con cada proveedor.</li>
        <li class="lang-en"><code>agents/main/agent/auth-profiles.json</code> â€” Contains the actual tokens/credentials the agent uses to authenticate with each provider.</li>
      </ul>

      <p class="lang-es">OpenAI y GitHub Copilot sÃ­ tenÃ­an sus credenciales ahÃ­. Anthropic no. Entonces cuando OpenAI fallaba y GitHub Copilot estaba en cooldown por rate limit, el failover intentaba Anthropic... y tambiÃ©n fallaba. El agente se quedaba sin opciones y respondÃ­a con el error como texto.</p>
      <p class="lang-en">OpenAI and GitHub Copilot did have their credentials there. Anthropic didn't. So when OpenAI failed and GitHub Copilot was in cooldown from rate limiting, failover tried Anthropic... and that also failed. The agent ran out of options and responded with the error as text.</p>

      <h3><span class="lang-es">El fix: Registrar las credenciales de Claude Code en el agente</span><span class="lang-en">The Fix: Register Claude Code Credentials in the Agent</span></h3>

      <p class="lang-es">Las credenciales de Claude Code viven en el macOS Keychain. Hay que copiarlas al <code>auth-profiles.json</code> del agente para que el failover pueda usarlas:</p>
      <p class="lang-en">Claude Code credentials live in the macOS Keychain. They need to be copied to the agent's <code>auth-profiles.json</code> so failover can use them:</p>

      <pre><code><span class="comment"># 1. Extraer las credenciales del Keychain</span>
<span class="command">security find-generic-password</span> <span class="flag">-s</span> <span class="string">"Claude Code-credentials"</span> <span class="flag">-w</span></code></pre>

      <p class="lang-es">Esto devuelve un JSON con <code>accessToken</code>, <code>refreshToken</code>, y <code>expiresAt</code>. Luego hay que agregarlos al auth-profiles:</p>
      <p class="lang-en">This returns a JSON with <code>accessToken</code>, <code>refreshToken</code>, and <code>expiresAt</code>. Then they need to be added to auth-profiles:</p>

      <pre><code><span class="comment"># 2. Agregar perfil de Anthropic en auth-profiles.json</span>
<span class="comment"># Archivo: ~/.openclaw/agents/main/agent/auth-profiles.json</span>
<span class="comment"># Agregar dentro de "profiles":</span>

<span class="string">"anthropic:claude-code"</span>: {
  <span class="string">"type"</span>: <span class="string">"oauth"</span>,
  <span class="string">"provider"</span>: <span class="string">"anthropic"</span>,
  <span class="string">"access"</span>: <span class="string">"sk-ant-oat01-..."</span>,   <span class="comment">// accessToken del Keychain</span>
  <span class="string">"refresh"</span>: <span class="string">"sk-ant-ort01-..."</span>,  <span class="comment">// refreshToken del Keychain</span>
  <span class="string">"expires"</span>: 1757037189278         <span class="comment">// expiresAt del Keychain</span>
}

<span class="comment"># Y agregar en "lastGood":</span>
<span class="string">"anthropic"</span>: <span class="string">"anthropic:claude-code"</span></code></pre>

      <p class="lang-es">DespuÃ©s de agregar las credenciales, reiniciar el gateway:</p>
      <p class="lang-en">After adding the credentials, restart the gateway:</p>

      <pre><code><span class="command">openclaw gateway restart</span></code></pre>

      <h3><span class="lang-es">El otro bug: el watchdog no encontraba <code>openclaw</code></span><span class="lang-en">The Other Bug: The Watchdog Couldn't Find <code>openclaw</code></span></h3>

      <p class="lang-es">El cron watchdog ejecutaba <code>openclaw gateway restart</code> pero fallaba con <code>zsh:1: command not found: openclaw</code>. El gateway corre como un proceso de fondo (LaunchAgent) y su shell no tiene el mismo PATH que tu terminal.</p>
      <p class="lang-en">The cron watchdog ran <code>openclaw gateway restart</code> but failed with <code>zsh:1: command not found: openclaw</code>. The gateway runs as a background process (LaunchAgent) and its shell doesn't have the same PATH as your terminal.</p>

      <p class="lang-es">La soluciÃ³n: usar la <strong>ruta absoluta</strong> del binario en el mensaje del cron:</p>
      <p class="lang-en">The solution: use the <strong>absolute path</strong> to the binary in the cron message:</p>

      <pre><code><span class="comment"># Antes (fallaba en background):</span>
<span class="output">"Ejecuta 'openclaw gateway restart' para reconectarlo."</span>

<span class="comment"># DespuÃ©s (funciona siempre):</span>
<span class="output">"Ejecuta '/ruta/completa/a/openclaw gateway restart' para reconectarlo."</span></code></pre>

      <div class="tip-box">
        <h4><span class="lang-es">âœ” LecciÃ³n aprendida</span><span class="lang-en">âœ” Lesson Learned</span></h4>
        <p class="lang-es">Configurar el failover tiene <strong>dos partes</strong>: (1) registrar los modelos en la config global, y (2) asegurarte de que las <strong>credenciales</strong> de cada proveedor estÃ©n en el <code>auth-profiles.json</code> del agente. Si falta cualquiera de las dos, el failover no funciona. Y para cron jobs, siempre usa rutas absolutas.</p>
        <p class="lang-en">Configuring failover has <strong>two parts</strong>: (1) register models in the global config, and (2) make sure the <strong>credentials</strong> of each provider are in the agent's <code>auth-profiles.json</code>. If either is missing, failover doesn't work. And for cron jobs, always use absolute paths.</p>
      </div>

      <h2><span class="lang-es">12. Checklist Final</span><span class="lang-en">12. Final Checklist</span></h2>

      <p class="lang-es">Para asegurarte de que tu setup estÃ¡ completo y no te pase lo que a mÃ­, revisa cada punto:</p>
      <p class="lang-en">To make sure your setup is complete and you don't go through what I did, check each point:</p>

      <table class="comparison-table">
        <thead>
          <tr>
            <th>Check</th>
            <th><span class="lang-es">Comando</span><span class="lang-en">Command</span></th>
            <th><span class="lang-es">QuÃ© verificar</span><span class="lang-en">What to Verify</span></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="lang-es">WhatsApp conectado</span><span class="lang-en">WhatsApp Connected</span></td>
            <td><code>openclaw channels status</code></td>
            <td>Status = CONNECTED</td>
          </tr>
          <tr>
            <td><span class="lang-es">Modelo primario responde</span><span class="lang-en">Primary Model Responds</span></td>
            <td><code>openclaw agent -m "ping" --deliver</code></td>
            <td><span class="lang-es">Recibes respuesta en WhatsApp</span><span class="lang-en">You receive a response on WhatsApp</span></td>
          </tr>
          <tr>
            <td><span class="lang-es">Fallbacks configurados</span><span class="lang-en">Fallbacks Configured</span></td>
            <td><code>openclaw config get agents.defaults.model</code></td>
            <td><span class="lang-es">Primary + fallbacks listados</span><span class="lang-en">Primary + fallbacks listed</span></td>
          </tr>
          <tr>
            <td><span class="lang-es">Auth de CADA proveedor</span><span class="lang-en">Auth for EACH Provider</span></td>
            <td><span class="lang-es">Revisar</span><span class="lang-en">Check</span> <code>auth-profiles.json</code></td>
            <td><span class="lang-es">Todos los fallbacks tienen credenciales</span><span class="lang-en">All fallbacks have credentials</span></td>
          </tr>
          <tr>
            <td><span class="lang-es">Watchdog activo</span><span class="lang-en">Watchdog Active</span></td>
            <td><code>openclaw cron list</code></td>
            <td>whatsapp-watchdog = ACTIVE</td>
          </tr>
          <tr>
            <td><span class="lang-es">Watchdog usa ruta absoluta</span><span class="lang-en">Watchdog Uses Absolute Path</span></td>
            <td><span class="lang-es">Revisar</span><span class="lang-en">Check</span> <code>cron/jobs.json</code></td>
            <td><span class="lang-es">Ruta completa al binario openclaw</span><span class="lang-en">Full path to openclaw binary</span></td>
          </tr>
        </tbody>
      </table>

      <div class="openclaw-box">
        <h4><span class="lang-es">ğŸ¦ Para los que quieren ir mÃ¡s allÃ¡</span><span class="lang-en">ğŸ¦ For Those Who Want to Go Further</span></h4>
        <p class="lang-es">Puedes agregar mÃ¡s canales (Telegram, Slack) como fallback de comunicaciÃ³n, configurar alertas por email cuando el watchdog detecta una falla, o incluso agregar proveedores locales (Ollama, LM Studio) como Ãºltimo-Ãºltimo recurso para funcionar completamente offline. Las posibilidades con OpenClaw son infinitas.</p>
        <p class="lang-en">You can add more channels (Telegram, Slack) as communication fallback, configure email alerts when the watchdog detects a failure, or even add local providers (Ollama, LM Studio) as a last-last resort to work completely offline. The possibilities with OpenClaw are endless.</p>
      </div>

      <h2><span class="lang-es">13. La Tormenta Perfecta: Los 3 Proveedores Cayeron a la Vez</span><span class="lang-en">13. The Perfect Storm: All 3 Providers Went Down at Once</span></h2>

      <p class="lang-es">Recuerdan que dije que si los 3 proveedores fallan al mismo tiempo "tenemos problemas mÃ¡s grandes"? Bueno, pasÃ³. Horas despuÃ©s de publicar este post, los 3 murieron simultÃ¡neamente:</p>
      <p class="lang-en">Remember when I said if all 3 providers fail at the same time "we have bigger problems"? Well, it happened. Hours after publishing this post, all 3 died simultaneously:</p>

      <div class="warning-box">
        <h4>ğŸ’€ Error: All models failed (3)</h4>
        <p>
          <code>github-copilot/claude-opus-4.6</code>: cooldown (rate_limit)<br>
          <code>anthropic/claude-sonnet-4-5-20250929</code>: OAuth token refresh failed<br>
          <code>openai-codex/gpt-5.3-codex</code>: ChatGPT Go plan usage limit (~5936 min)
        </p>
      </div>

      <p class="lang-es">Tres fallas distintas, cada una por una razÃ³n diferente. Un rate limit, un token expirado, y un lÃ­mite de plan. La combinaciÃ³n perfecta para dejar al bot completamente muerto.</p>
      <p class="lang-en">Three distinct failures, each for a different reason. A rate limit, an expired token, and a plan limit. The perfect combination to leave the bot completely dead.</p>

      <h3><span class="lang-es">Root cause #1: Tokens de Anthropic expirados en el Keychain</span><span class="lang-en">Root cause #1: Expired Anthropic Tokens in the Keychain</span></h3>

      <p class="lang-es">Las credenciales de Claude Code en el macOS Keychain estaban expiradas <strong>desde septiembre 2025</strong>. Claude Code funciona en memoria con tokens frescos, pero <strong>no actualiza el Keychain</strong> cuando renueva sus tokens internamente. OpenClaw lee del Keychain â†’ obtiene tokens viejos â†’ OAuth refresh falla â†’ proveedor muerto.</p>
      <p class="lang-en">Claude Code credentials in the macOS Keychain had been expired <strong>since September 2025</strong>. Claude Code works in memory with fresh tokens, but <strong>doesn't update the Keychain</strong> when it renews its tokens internally. OpenClaw reads from Keychain â†’ gets old tokens â†’ OAuth refresh fails â†’ provider dead.</p>

      <pre><code><span class="comment"># Verificar cuÃ¡ndo se modificÃ³ el Keychain:</span>
<span class="command">security find-generic-password</span> <span class="flag">-s</span> <span class="string">"Claude Code-credentials"</span> <span class="flag">-g</span> 2&gt;&amp;1 | grep mdat
<span class="output">mdat=0x323032353039... (September 2025!)</span></code></pre>

      <h3><span class="lang-es">Root cause #2: El cooldown exponencial en cascada</span><span class="lang-en">Root cause #2: The Cascading Exponential Cooldown</span></h3>

      <p class="lang-es">RevisÃ© el cÃ³digo fuente de OpenClaw y encontrÃ© la trampa. Cuando un proveedor recibe un error 429 (rate limit), OpenClaw pone el perfil de autenticaciÃ³n en <strong>cooldown exponencial</strong>:</p>
      <p class="lang-en">I reviewed the OpenClaw source code and found the trap. When a provider receives a 429 error (rate limit), OpenClaw puts the authentication profile in <strong>exponential cooldown</strong>:</p>

      <table class="comparison-table">
        <thead>
          <tr>
            <th><span class="lang-es">Error #</span><span class="lang-en">Error #</span></th>
            <th>Cooldown</th>
            <th><span class="lang-es">Efecto</span><span class="lang-en">Effect</span></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="lang-es">1er error</span><span class="lang-en">1st error</span></td>
            <td>60 <span class="lang-es">segundos</span><span class="lang-en">seconds</span></td>
            <td><span class="lang-es">Pausa corta, tolerable</span><span class="lang-en">Short pause, tolerable</span></td>
          </tr>
          <tr>
            <td><span class="lang-es">2do error</span><span class="lang-en">2nd error</span></td>
            <td>5 <span class="lang-es">minutos</span><span class="lang-en">minutes</span></td>
            <td><span class="lang-es">Empieza a doler</span><span class="lang-en">Starting to hurt</span></td>
          </tr>
          <tr>
            <td><span class="lang-es">3er error</span><span class="lang-en">3rd error</span></td>
            <td>25 <span class="lang-es">minutos</span><span class="lang-en">minutes</span></td>
            <td><span class="lang-es">Proveedor bÃ¡sicamente muerto</span><span class="lang-en">Provider basically dead</span></td>
          </tr>
          <tr>
            <td><span class="lang-es">4to+ error</span><span class="lang-en">4th+ error</span></td>
            <td>1 <span class="lang-es">hora (mÃ¡ximo)</span><span class="lang-en">hour (maximum)</span></td>
            <td>Game over</td>
          </tr>
        </tbody>
      </table>

      <p class="lang-es">El problema: el cooldown es <strong>global por perfil</strong>. Si el gateway procesa mÃºltiples mensajes de WhatsApp concurrentemente (o un cron job al mismo tiempo), cada request fallido incrementa el contador. En segundos, el cooldown escala de 60s a 1 hora, y <strong>todos</strong> los requests siguientes fallan instantÃ¡neamente sin siquiera intentar llamar al API.</p>
      <p class="lang-en">The problem: cooldown is <strong>global per profile</strong>. If the gateway processes multiple WhatsApp messages concurrently (or a cron job at the same time), each failed request increments the counter. In seconds, cooldown escalates from 60s to 1 hour, and <strong>all</strong> subsequent requests fail instantly without even trying to call the API.</p>

      <p class="lang-es">AdemÃ¡s, descubrÃ­ en los logs que los "rate limits" de 23 segundos en realidad eran <strong>timeouts</strong>. El API de Anthropic se colgaba (en vez de devolver 429 instantÃ¡neo), el request expiraba, y OpenClaw lo clasificaba como rate limit con el comentario en el cÃ³digo: <code>// Treat timeout as potential rate limit (Antigravity hangs on rate limit)</code>.</p>
      <p class="lang-en">Additionally, I discovered in the logs that the 23-second "rate limits" were actually <strong>timeouts</strong>. The Anthropic API would hang (instead of returning an instant 429), the request would expire, and OpenClaw classified it as a rate limit with the code comment: <code>// Treat timeout as potential rate limit (Antigravity hangs on rate limit)</code>.</p>

      <h3><span class="lang-es">Root cause #3: Config error que eliminÃ³ un proveedor de la cadena</span><span class="lang-en">Root cause #3: Config Error That Removed a Provider from the Chain</span></h3>

      <p class="lang-es">Durante el debugging, cambiÃ© el modelo primario de <code>openai-codex</code> a <code>anthropic</code> para forzar pruebas directas. Esto causÃ³ que la cadena de failover pasara de <strong>3 proveedores a 2</strong>:</p>
      <p class="lang-en">During debugging, I changed the primary model from <code>openai-codex</code> to <code>anthropic</code> to force direct testing. This caused the failover chain to go from <strong>3 providers to 2</strong>:</p>

      <pre><code><span class="comment"># Config durante debugging (MAL / WRONG):</span>
<span class="string">"primary"</span>: <span class="string">"anthropic/claude-sonnet-4-5-20250929"</span>    <span class="comment">// anthropic como primario</span>
<span class="string">"fallbacks"</span>: [
  <span class="string">"github-copilot/claude-opus-4.6"</span>,              <span class="comment">// fallback 1</span>
  <span class="string">"anthropic/claude-sonnet-4-5-20250929"</span>          <span class="comment">// duplicado = eliminado</span>
]
<span class="comment">// Resultado: solo 2 proveedores! openai-codex quedÃ³ fuera</span>

<span class="comment"># Config correcta / Correct config:</span>
<span class="string">"primary"</span>: <span class="string">"openai-codex/gpt-5.3-codex"</span>               <span class="comment">// openai como primario</span>
<span class="string">"fallbacks"</span>: [
  <span class="string">"github-copilot/claude-opus-4.6"</span>,              <span class="comment">// fallback 1</span>
  <span class="string">"anthropic/claude-sonnet-4-5-20250929"</span>          <span class="comment">// fallback 2</span>
]
<span class="comment">// Resultado: 3 proveedores en cadena</span></code></pre>

      <p class="lang-es">Los logs del gateway confirmaban: <code>All models failed (2)</code> â€” no 3. OpenClaw deduplica los modelos, asÃ­ que anthropic como primario + anthropic como fallback = un solo proveedor.</p>
      <p class="lang-en">The gateway logs confirmed: <code>All models failed (2)</code> â€” not 3. OpenClaw deduplicates models, so anthropic as primary + anthropic as fallback = a single provider.</p>

      <h3><span class="lang-es">El fix: Tokens frescos via OAuth PKCE + restaurar la cadena</span><span class="lang-en">The Fix: Fresh Tokens via OAuth PKCE + Restore the Chain</span></h3>

      <p class="lang-es">La soluciÃ³n tuvo 3 partes:</p>
      <p class="lang-en">The solution had 3 parts:</p>

      <p class="lang-es"><strong>Parte 1:</strong> Obtener tokens frescos de Anthropic haciendo el flujo OAuth PKCE manualmente (el mismo que usa Claude Code internamente):</p>
      <p class="lang-en"><strong>Part 1:</strong> Get fresh Anthropic tokens by doing the OAuth PKCE flow manually (the same one Claude Code uses internally):</p>

      <pre><code><span class="comment"># 1. Generar PKCE verifier + challenge</span>
<span class="comment"># 2. Abrir URL de autorizaciÃ³n en claude.ai/oauth/authorize</span>
<span class="comment"># 3. Copiar el cÃ³digo del callback</span>
<span class="comment"># 4. Intercambiar cÃ³digo por tokens frescos:</span>
<span class="command">curl</span> <span class="flag">-X POST</span> <span class="string">https://console.anthropic.com/v1/oauth/token</span> \
  <span class="flag">-H</span> <span class="string">"Content-Type: application/json"</span> \
  <span class="flag">-d</span> <span class="string">'{"grant_type":"authorization_code","code":"...","code_verifier":"...","client_id":"...","redirect_uri":"..."}'</span>

<span class="comment"># Resultado: access_token + refresh_token frescos (8 horas)</span></code></pre>

      <p class="lang-es"><strong>Parte 2:</strong> Restaurar el modelo primario a <code>openai-codex/gpt-5.3-codex</code> para tener los 3 proveedores en la cadena.</p>
      <p class="lang-en"><strong>Part 2:</strong> Restore the primary model to <code>openai-codex/gpt-5.3-codex</code> to have all 3 providers in the chain.</p>

      <p class="lang-es"><strong>Parte 3:</strong> Limpiar los cooldowns acumulados en <code>auth-profiles.json</code> y reiniciar el gateway:</p>
      <p class="lang-en"><strong>Part 3:</strong> Clear the accumulated cooldowns in <code>auth-profiles.json</code> and restart the gateway:</p>

      <pre><code><span class="comment"># Limpiar cooldowns (en auth-profiles.json, cambiar usageStats a vacÃ­o):</span>
<span class="string">"usageStats"</span>: {}

<span class="comment"># Reiniciar:</span>
<span class="command">openclaw gateway restart</span></code></pre>

      <p class="lang-es">Resultado del test despuÃ©s del fix:</p>
      <p class="lang-en">Test result after the fix:</p>

      <pre><code><span class="command">openclaw agent</span> <span class="flag">--session-id</span> <span class="string">"test-fix"</span> <span class="flag">-m</span> <span class="string">"di OK"</span>
<span class="output">[failover] openai-codex: rate_limit (10s) â†’ skip</span>
<span class="output">[failover] github-copilot: rate_limit (22s) â†’ skip</span>
<span class="output">[failover] anthropic: âœ“ success</span>
<span class="output">OK</span></code></pre>

      <div class="tip-box">
        <h4><span class="lang-es">âœ” Bot restaurado</span><span class="lang-en">âœ” Bot Restored</span></h4>
        <p class="lang-es">Los 2 primeros proveedores siguen con rate limit temporal, pero el tercero (Anthropic con tokens frescos) responde correctamente. La cadena de failover funciona como debe: si los primeros fallan, el tercero entra.</p>
        <p class="lang-en">The first 2 providers still have temporary rate limits, but the third (Anthropic with fresh tokens) responds correctly. The failover chain works as it should: if the first ones fail, the third one steps in.</p>
      </div>

      <h2><span class="lang-es">14. Lecciones del Incidente</span><span class="lang-en">14. Lessons from the Incident</span></h2>

      <ol>
        <li class="lang-es"><strong>El Keychain miente.</strong> Claude Code funciona en memoria con tokens frescos pero no actualiza el Keychain. Si dependes del Keychain para credenciales, verifica que no estÃ©n expiradas.</li>
        <li class="lang-en"><strong>The Keychain lies.</strong> Claude Code works in memory with fresh tokens but doesn't update the Keychain. If you rely on the Keychain for credentials, verify they're not expired.</li>
        <li class="lang-es"><strong>El cooldown exponencial es una espada de doble filo.</strong> Protege contra spam al API, pero en un escenario con mÃºltiples requests concurrentes, un solo error escala en segundos a 1 hora de bloqueo total.</li>
        <li class="lang-en"><strong>Exponential cooldown is a double-edged sword.</strong> It protects against API spam, but in a scenario with multiple concurrent requests, a single error escalates in seconds to 1 hour of total blocking.</li>
        <li class="lang-es"><strong>Nunca cambies el primary model para "debug rÃ¡pido".</strong> Si tu primary es igual a un fallback, OpenClaw deduplica y pierdes un proveedor de la cadena sin darte cuenta.</li>
        <li class="lang-en"><strong>Never change the primary model for "quick debugging".</strong> If your primary equals a fallback, OpenClaw deduplicates and you lose a provider from the chain without realizing it.</li>
        <li class="lang-es"><strong>Los timeouts se clasifican como rate limits.</strong> Una respuesta lenta del API (23s timeout) cuenta igual que un 429 real. Esto acelera el cooldown exponencial artificialmente.</li>
        <li class="lang-en"><strong>Timeouts are classified as rate limits.</strong> A slow API response (23s timeout) counts the same as a real 429. This artificially accelerates exponential cooldown.</li>
        <li class="lang-es"><strong>Limpia <code>usageStats</code> despuÃ©s de arreglar la causa raÃ­z.</strong> Si no limpias los cooldowns acumulados, el gateway sigue rechazando requests instantÃ¡neamente incluso con tokens frescos.</li>
        <li class="lang-en"><strong>Clean <code>usageStats</code> after fixing the root cause.</strong> If you don't clear the accumulated cooldowns, the gateway keeps rejecting requests instantly even with fresh tokens.</li>
      </ol>

      <div class="openclaw-box">
        <h4><span class="lang-es">ğŸ¦ El setup actualizado</span><span class="lang-en">ğŸ¦ The Updated Setup</span></h4>
        <p class="lang-es">DespuÃ©s de este incidente, la cadena de failover tiene <strong>3 proveedores activos</strong> con tokens verificados, cooldowns limpios, y el primary model correctamente configurado. La prÃ³xima vez que un proveedor falle, los otros dos entran. Y si los 3 fallan... bueno, ya sÃ© cÃ³mo arreglarlo en 5 minutos en vez de 5 horas.</p>
        <p class="lang-en">After this incident, the failover chain has <strong>3 active providers</strong> with verified tokens, clean cooldowns, and the primary model correctly configured. Next time a provider fails, the other two step in. And if all 3 fail... well, now I know how to fix it in 5 minutes instead of 5 hours.</p>
      </div>

    </div>
  </main>

  <footer class="post-footer">
    <div class="container">
      <p><span class="lang-es">Escrito por <strong>Oscar MartÃ­nez</strong> â€” 14-16 de febrero de 2026</span><span class="lang-en">Written by <strong>Oscar MartÃ­nez</strong> â€” February 14-16, 2026</span></p>
      <p style="margin-top: 10px;">
        <a href="index.html"><span class="lang-es">Volver al inicio</span><span class="lang-en">Back to home</span></a>
      </p>
    </div>
  </footer>

</body>
</html>
